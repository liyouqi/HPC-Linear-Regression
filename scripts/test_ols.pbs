#!/bin/bash
#PBS -N test_ols
#PBS -l nodes=1:ppn=32
#PBS -l walltime=00:10:00
#PBS -q shortHPC4DS
#PBS -j oe
#PBS -o test_ols.log

# Simple test job for OLS parallel linear regression

cd $PBS_O_WORKDIR
cd ..

# Load required modules
module load gompi/2023a

# Print environment info
echo "=== Job Information ==="
echo "Job ID: $PBS_JOBID"
echo "Hostname: $(hostname)"
echo "Working directory: $(pwd)"
echo "Date: $(date)"
echo ""

# Test with different process counts
for NPROCS in 1 2 4 8; do
    echo "========================================="
    echo "Running with $NPROCS processes"
    echo "========================================="
    mpirun -np $NPROCS ./parallel_lr
    echo ""
done

echo "=== Job completed at $(date) ==="
